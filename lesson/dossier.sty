

\NeedsTeXFormat{LaTeX2e}

\ProvidesPackage{dossier}[2020/01/01 Extension personnelle, V1.0]

% common
\newcommand{\openFileStream}[2]
{% ouvre le flux de fichier
  \immediate\openout#1 #2%
}
\newcommand{\closeFileStream}[1]
{% ferme le flux de fichier
  \immediate\closeout#1%
}
\newcommand{\writeExpandedFileStream}[2]
{% écrit un court texte dans le fichier
  \immediate\write#1{\expanded{#2}}%
}
\newcommand{\writeUnexpandedFileStream}[2]
{% écrit un court texte dans le fichier
  \immediate\write#1{\unexpanded{#2}}%
}








%----------------------------------------------------------------------------- call for validation
%-----------------------------------------------------------------------------
\newcounter{evaluationCompetences}
\newwrite{\output@stream@evaluationCompetences}
\def\outputFile{tmp/evaluationCompetences/grilleEvaluation.csv}
\openFileStream{\output@stream@evaluationCompetences}{\outputFile}
\writeUnexpandedFileStream{\output@stream@evaluationCompetences}{
    evaluation|competence|savoirfaire|attendus|a|b|c|d
}
\newcommand{\formateurEvaluationCompetences}[2]{%
    \stepcounter{evaluationCompetences}

    \textit{\textbf{\color{red}$\blacksquare$~Appeller le formateur.}}\\
    \begin{tabular}{ |c|c|c|c|c|c|c|c| }
        \hline
        \rowcolor{gray!16}\multicolumn{2}{|l}{ \bfseries Evaluation \theevaluationCompetences } &
        \multicolumn{2}{c}{ \bfseries #1} &
        \multicolumn{4}{c|}{ \color{red}\bfseries\textit{Cadre réservé au formateur} }\\
        %\hline
        \rowcolor{gray!8}
        \multicolumn{2}{|L{.23\textwidth}}{$\Box$ Non traité } & 
        \multicolumn{2}{L{.22\textwidth}}{$\Box$ Non acquis} & 
        \multicolumn{2}{L{.25\textwidth}}{$\Box$ En cours d'acquisition} & 
        \multicolumn{2}{L{.22\textwidth}|}{$\Box$ Acquis}\\
        %\rowcolor{gray!32} \textbf{Cadre réservé au formateur} & ~ \\
        %\rowcolor{gray!32} \makecell[l]{ $\Box$ Non acquis} & \makecell[l]{ $\Box$ En cours d'acquisition}  \\
        \hline
    \end{tabular}


    
    \def\exa{Le dossier de fabrication produit est conforme aux contraintes. equipe}
    \writeExpandedFileStream{\output@stream@evaluationCompetences}{
        \theevaluationCompetences|#1|\exa|a|b|c|d|
    }
}

\newcommand{\formateurEvaluationCompetencesGrid}{%
    \closeFileStream{\output@stream@evaluationCompetences}

    \DTLloaddb{grille}{\outputFile}

    \begin{center}
        \begin{longtable}{ |C{.02\textwidth}  |C{.15\textwidth}|L{.320\textwidth}|L{.285\textwidth} |C{.10\textwidth} |}
            \hline
            \rowcolor{gray!16}
            \bfseries E &
            \bfseries Compétence &
            \bfseries Savoir-faire &
            \bfseries Résultats attendus &
            \bfseries Note
            \DTLforeach*{grille}{%
            \evaluation=evaluation, \competence=competence, \savoirfaire=savoirfaire, \attendus=attendus}{%
            \\\hline\DTLifoddrow{\rowcolor{orange!8}}{\rowcolor{yellow!8}}%
            \evaluation & \competence &\savoirfaire & \attendus & $\Box~\Box~\Box~\Box$}%
            \\ \hline
        \end{longtable}
    \end{center}

   % \begin{tabular}{|L{.4\textwidth}|}
    %\input{\outputFile}
    %\end{tabular}
}
% https://tex.stackexchange.com/questions/23253/how-to-append-data-to-a-temporary-file


%----------------------------------------------------------------------------- fin call for validation






